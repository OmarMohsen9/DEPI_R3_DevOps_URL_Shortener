<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FastAPI URL Shortener</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-md">
    <h2 class="text-2xl font-bold mb-4 text-gray-800 text-center">URL Shortener</h2>

    <input type="text" id="longUrl" placeholder="https://example.com"
      class="w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4" />

    <div class="flex gap-2">
      <button id="shortenBtn"
        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition">
        Shorten URL
      </button>
      <button id="copyBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-md hidden">
        Copy
      </button>
    </div>

    <p id="result" class="mt-4 text-center font-medium text-gray-700"></p>
  </div>

  <script>
    const shortenBtn = document.getElementById('shortenBtn');
    const copyBtn = document.getElementById('copyBtn');
    const resultEl = document.getElementById('result');

    function ensureProtocol(url) {
      url = url.trim();
      if (!url) return "";
      if (!url.startsWith("http://") && !url.startsWith("https://")) {
        return "https://" + url;
      }
      return url;
    }

    shortenBtn.addEventListener('click', async () => {
      let longUrl = ensureProtocol(document.getElementById('longUrl').value);
      if (!longUrl) {
        alert("Please enter a URL first!");
        return;
      }

      shortenBtn.disabled = true;
      shortenBtn.textContent = "Shortening...";

      try {
        const resp = await fetch("/shorten", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ long_url: longUrl })
        });

        const data = await resp.json();

        if (resp.ok) {
          resultEl.innerHTML = `
            <span class="text-green-600">✅ Shortened:</span>
            <a id="shortLink" href="${data.short_url}" target="_blank" class="text-blue-600 underline">${data.short_url}</a>
          `;
          copyBtn.classList.remove('hidden');
        } else {
          resultEl.innerHTML = `<span class="text-red-600">❌ Error:</span> ${data.detail || JSON.stringify(data)}`;
        }
      } catch (err) {
        resultEl.innerHTML = `<span class="text-red-600">❌ Network error</span>`;
      } finally {
        shortenBtn.disabled = false;
        shortenBtn.textContent = "Shorten URL";
      }
    });

    copyBtn.addEventListener('click', async () => {
      const a = document.getElementById('shortLink');
      if (!a) return;
      try {
        await navigator.clipboard.writeText(a.href);
        copyBtn.textContent = "Copied!";
        setTimeout(() => copyBtn.textContent = "Copy", 1500);
      } catch (e) {
        alert("Copy failed");
      }
    });
  </script>
</body>
</html>
